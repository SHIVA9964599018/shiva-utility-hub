<!DOCTYPE html>
<html>
<head>
  <title>Shiva's Utility Hub</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style.css"> 
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#4CAF50">
</head>
<body>

<!-- Loading Overlay -->
<div id="loading-overlay">
  <div class="loading-box">
    <p>Loading utility data, please wait...</p>
  </div>
</div>

<!-- Simplified Navbar -->
<nav>
  <div class="dropdown">
    <a href="#" class="dropdown-toggle">Utilities</a>
    <div class="dropdown-menu">
      <a href="#" data-sub="utility-add-dish">Add Dish</a>
      <a href="#" onclick="promptCalorieLogin()">Daily Calorie</a>
      <a href="#" data-sub="utility-food-facts" data-load="food-facts">All Food Facts</a>
    </div>
  </div>
</nav>

<section id="utilities" style="padding: 20px;">

  <!-- Add Dish -->
  <div id="utility-add-dish" style="display:none;">
    <h3>Add Dish Nutrition Info</h3>
    <form id="nutrition-form" class="nutrition-form">
      <label>Dish Name: <input type="text" id="dish_name" required></label>
      <label>Calories (per 100gm): <input type="number" id="calorie" step="any" required></label>
      <label>Protein (per 100gm): <input type="number" id="protein" step="any" required></label>
      <label>Carbs (per 100gm): <input type="number" id="carbs" step="any" required></label>
      <label>Fibre (per 100gm): <input type="number" id="fibre" step="any" required></label>
      <label>Fats (per 100gm): <input type="number" id="fats" step="any" required></label>
      <button type="submit">Save Dish</button>
    </form>
    <p id="nutrition-message" style="margin-top: 20px;"></p>
  </div>

  <!-- Daily Calorie Calculator -->
  <div id="utility-daily-calorie" style="display: none;">
    <div style="display: flex; gap: 2px; align-items: flex-start;">
      <div style="flex: 1;">
        <h3>Daily Calorie Calculator</h3>

        <!-- Meal Sections -->
        <div>
          <h4>Breakfast</h4>
          <button onclick="addDishRow('breakfast')">+ Add</button>
          <div id="breakfast-container" class="meal-container"></div>
        </div>
        <div>
          <h4>Lunch</h4>
          <button onclick="addDishRow('lunch')">+ Add</button>
          <div id="lunch-container" class="meal-container"></div>
        </div>
        <div>
          <h4>Dinner</h4>
          <button onclick="addDishRow('dinner')">+ Add</button>
          <div id="dinner-container" class="meal-container"></div>
        </div>

        <button id="calculate-btn" style="margin-top: 20px;">Calculate</button>
        <div id="calorie-result" style="margin-top: 20px;"></div>
      </div>

      <!-- Dish Summary Table -->
      <div style="flex: 2;">
        <h3>Saved Dish Summary (From Supabase)</h3>
        <table border="1" cellpadding="6" cellspacing="0" style="width: 100%;">
          <thead>
            <tr>
              <th>Dish Name</th>
              <th>Qty (g)</th>
              <th>Calories</th>
              <th>Protein</th>
              <th>Carbs</th>
              <th>Fibre</th>
              <th>Fats</th>
            </tr>
          </thead>
          <tbody id="dish-summary-body"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- All Food Facts -->
  <div id="utility-food-facts" style="display:none;">
    <h3>All Food Facts</h3>
    <div id="food-facts-table-container">
      <table id="food-facts-table" border="1" cellspacing="0" cellpadding="6">
        <thead>
          <tr>
            <th>Dish Name</th>
            <th>Cal/100g</th>
            <th>Protein</th>
            <th>Carbs</th>
            <th>Fibre</th>
            <th>Fats</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

</section>

<!-- Login Modal -->
<div id="loginModal" style="display:none; position:fixed; top:30%; left:50%; transform:translate(-50%, -50%); background:#fff; padding:20px; border:1px solid #ccc; box-shadow:0 2px 10px rgba(0,0,0,0.2); z-index:9999;">
  <h3>Login to access Calorie Tracker</h3>
  <input type="text" id="usernameInput" placeholder="Username"><br><br>
  <input type="password" id="passwordInput" placeholder="Password"><br><br>
  <button onclick="handleCalorieLogin()">Login</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<script type="module" src="script.js"></script>
</body>
</html>
